language: yaml
databaseChangeLog:
  - changeSet:
      id: update-show-dates
      author: de-meyer
      changes:
        - sql:
            dbms: postgresql
            splitStatements: false
            stripComments: false
            sql: |
              WITH cte AS (
               SELECT id,
                      date,
                      row_number() OVER (ORDER BY id) AS rn,
                      count(*) OVER () AS cnt
               FROM "show"
              )
              UPDATE "show" s
              SET date = CASE
                WHEN (date_trunc('day', s.date AT TIME ZONE 'UTC')::date) = '2025-10-01'::date
                  THEN (date_trunc('day', now() AT TIME ZONE 'UTC') + (s.date AT TIME ZONE 'UTC')::time) AT TIME ZONE 'UTC'
                WHEN (date_trunc('day', s.date AT TIME ZONE 'UTC')::date) = '2025-10-02'::date
                  THEN ((date_trunc('day', now() AT TIME ZONE 'UTC') + interval '1 day') + (s.date AT TIME ZONE 'UTC')::time) AT TIME ZONE 'UTC'
                ELSE s.date
              END
              FROM cte
              WHERE s.id = cte.id;